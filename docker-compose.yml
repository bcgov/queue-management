version: '2'

services:

  keycloak:
    environment:
      - DOCKER_HOST=tcp://0.0.0.0:2375
    build: ./keycloak-local-testserver
    ports:
      - 8085:8080
  mysql_db:
    image: mysql:5.7.22
    restart: always
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root

  api:
    build: ./api
    ports:
      - "5000:5000"
      - "8088:8088"
    environment:
      DATABASE_ENGINE: mysql
      DATABASE_USERNAME: root
      DATABASE_PASSWORD: root
      DATABASE_NAME: queue_management
      DATABASE_PORT: 3306
      DATABASE_HOST: mysql_db
      THEQ_SNOWPLOW_CALLFLAG: "false"
    links:
      - mysql_db
    volumes:
      - "./api:/opt/queue-management-api"
      - "/opt/queue-management-api/env"

  frontend:
    build: ./frontend
    ports:
      - "8080:8080"
    volumes:
      - "./frontend:/opt/queue-management-frontend"
#      - "node_modules:/opt/queue-management-frontend/node_modules"
    command: bash -c "npm i && npm start localhost"


volumes:
  node_modules:
    driver: local
